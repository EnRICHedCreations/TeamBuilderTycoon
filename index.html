<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Builder Tycoon - Wholesaling Game</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #333; min-height: 100vh; padding: 20px; }
        .game-container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
        .game-header { background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%); color: white; padding: 20px 30px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; }
        .game-title { font-size: 28px; font-weight: bold; }
        .stats-bar { display: flex; gap: 25px; flex-wrap: wrap; }
        .stat { display: flex; flex-direction: column; align-items: center; }
        .stat-label { font-size: 11px; text-transform: uppercase; opacity: 0.8; margin-bottom: 3px; }
        .stat-value { font-size: 18px; font-weight: bold; }
        .cash { color: #48bb78; }
        .week { color: #90cdf4; }
        .deals { color: #fbd38d; }
        .game-content { display: grid; grid-template-columns: 250px 1fr; min-height: 700px; }
        .sidebar { background: #f7fafc; border-right: 2px solid #e2e8f0; padding: 20px; }
        .nav-button { width: 100%; padding: 12px 15px; margin-bottom: 8px; background: white; border: 2px solid #e2e8f0; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.2s; text-align: left; }
        .nav-button:hover { background: #edf2f7; border-color: #cbd5e0; }
        .nav-button.active { background: #667eea; color: white; border-color: #667eea; }
        .main-content { padding: 30px; overflow-y: auto; max-height: 700px; }
        .section-title { font-size: 24px; font-weight: bold; margin-bottom: 20px; color: #2d3748; }
        .card { background: white; border: 2px solid #e2e8f0; border-radius: 12px; padding: 20px; margin-bottom: 15px; }
        .card-title { font-size: 18px; font-weight: bold; margin-bottom: 12px; color: #2d3748; }
        .button { padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.2s; }
        .button:hover:not(:disabled) { background: #5568d3; transform: translateY(-1px); }
        .button:disabled { background: #cbd5e0; cursor: not-allowed; transform: none; }
        .button-small { padding: 6px 12px; font-size: 12px; }
        .button-success { background: #48bb78; }
        .button-success:hover:not(:disabled) { background: #38a169; }
        .button-danger { background: #f56565; }
        .button-danger:hover { background: #e53e3e; }
        .team-grid, .hire-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; }
        .team-member, .hire-card { border: 2px solid #e2e8f0; border-radius: 12px; padding: 15px; background: #f7fafc; }
        .hire-card { background: white; transition: all 0.2s; }
        .hire-card:hover { border-color: #667eea; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15); }
        .team-member-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px; }
        .team-member-name { font-weight: bold; font-size: 16px; }
        .team-member-role { font-size: 12px; color: #718096; margin-bottom: 8px; }
        .progress-bar { background: #e2e8f0; height: 8px; border-radius: 4px; overflow: hidden; margin: 8px 0; }
        .progress-fill { height: 100%; background: #48bb78; transition: width 0.3s; }
        .deal-pipeline { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px; }
        .pipeline-column { background: #f7fafc; border-radius: 12px; padding: 15px; min-height: 200px; }
        .pipeline-title { font-weight: bold; margin-bottom: 12px; color: #2d3748; font-size: 14px; }
        .deal-card { background: white; border: 2px solid #e2e8f0; border-radius: 8px; padding: 12px; margin-bottom: 8px; font-size: 13px; cursor: pointer; transition: all 0.2s; }
        .deal-card:hover { border-color: #667eea; box-shadow: 0 2px 8px rgba(102, 126, 234, 0.15); }
        .deal-value { font-weight: bold; color: #48bb78; margin-top: 5px; }
        .action-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; }
        .action-card { border: 2px solid #e2e8f0; border-radius: 12px; padding: 20px; background: white; cursor: pointer; transition: all 0.2s; }
        .action-card:hover:not(.disabled) { border-color: #667eea; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15); }
        .action-card.disabled { opacity: 0.5; cursor: not-allowed; }
        .action-title { font-weight: bold; font-size: 16px; margin-bottom: 8px; }
        .action-cost { color: #718096; font-size: 13px; margin-bottom: 8px; }
        .time-badge { display: inline-block; background: #fbd38d; color: #744210; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600; }
        .cost-badge { display: inline-block; background: #48bb78; color: white; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600; margin-left: 5px; }
        .locked-badge { display: inline-block; background: #f56565; color: white; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 600; margin-top: 5px; }
        .notification { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border-left: 6px solid #48bb78; padding: 25px 35px; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.3); max-width: 500px; font-size: 18px; font-weight: 600; animation: popIn 0.3s; z-index: 1000; text-align: center; }
        @keyframes popIn { from { transform: translate(-50%, -50%) scale(0.8); opacity: 0; } to { transform: translate(-50%, -50%) scale(1); opacity: 1; } }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        .modal-content { background: white; border-radius: 16px; padding: 30px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto; }
        .modal-title { font-size: 24px; font-weight: bold; margin-bottom: 15px; }
        .modal-buttons { display: flex; gap: 10px; margin-top: 20px; }
        .info-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e2e8f0; }
        .info-label { color: #718096; font-size: 14px; }
        .info-value { font-weight: 600; font-size: 14px; }
        .property-list { max-height: 300px; overflow-y: auto; margin: 15px 0; }
        .property-option { border: 2px solid #e2e8f0; border-radius: 8px; padding: 12px; margin-bottom: 8px; cursor: pointer; transition: all 0.2s; }
        .property-option:hover { border-color: #667eea; background: #f7fafc; }
        .property-option.selected { border-color: #667eea; background: #edf2f7; }
        @media (max-width: 768px) { .game-content { grid-template-columns: 1fr; } .sidebar { border-right: none; border-bottom: 2px solid #e2e8f0; } }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <div class="game-title">üè¢ Team Builder Tycoon - Build Your Wholesaling Empire</div>
            <div class="stats-bar">
                <div class="stat"><div class="stat-label">Cash</div><div class="stat-value cash">$<span id="cash">0</span></div></div>
                <div class="stat"><div class="stat-label">Week</div><div class="stat-value week"><span id="week">1</span></div></div>
                <div class="stat"><div class="stat-label">Deals Closed</div><div class="stat-value deals"><span id="dealsCount">0</span></div></div>
                <div class="stat"><div class="stat-label">Time Left</div><div class="stat-value"><span id="timeLeft">40</span>h</div></div>
            </div>
        </div>
        <div class="game-content">
            <div class="sidebar">
                <button class="nav-button active" data-section="actions">üìã Actions</button>
                <button class="nav-button" data-section="deals">üíº Deals</button>
                <button class="nav-button" data-section="team">üë• Team</button>
                <button class="nav-button" data-section="hire">‚ûï Hire</button>
                <button class="nav-button" data-section="upgrades">‚¨ÜÔ∏è Upgrades</button>
                <button class="nav-button" data-section="settings">‚öôÔ∏è Settings</button>
            </div>
            <div class="main-content">
                <div id="content-actions" class="content-section">
                    <div class="section-title">Weekly Actions</div>
                    <div class="action-grid" id="actionGrid"></div>
                    <div style="margin-top: 30px;">
                        <button class="button button-success" id="advanceWeekBtn" style="font-size: 16px; padding: 15px 30px;">‚è≠Ô∏è Advance to Next Week</button>
                    </div>
                </div>
                <div id="content-deals" class="content-section" style="display:none;">
                    <div class="section-title">Deal Pipeline</div>
                    <div class="deal-pipeline" id="dealPipeline"></div>
                </div>
                <div id="content-team" class="content-section" style="display:none;">
                    <div class="section-title">My Team</div>
                    <div class="team-grid" id="teamGrid"></div>
                    <div id="soloMessage" style="text-align: center; padding: 40px; color: #718096;">
                        <div style="font-size: 48px; margin-bottom: 15px;">ü¶∏</div>
                        <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">Flying Solo!</div>
                        <div>You haven't hired anyone yet. Check the Hire tab when you're ready to build your team.</div>
                    </div>
                </div>
                <div id="content-hire" class="content-section" style="display:none;">
                    <div class="section-title">Hire Team Members</div>
                    <div class="hire-grid" id="hireGrid"></div>
                </div>
                <div id="content-upgrades" class="content-section" style="display:none;">
                    <div class="section-title">Upgrades & Tools</div>
                    <div class="hire-grid" id="upgradeGrid"></div>
                </div>
                <div id="content-settings" class="content-section" style="display:none;">
                    <div class="section-title">Game Settings</div>
                    <div class="card">
                        <div class="card-title">Reset Progress</div>
                        <p style="margin-bottom: 15px; color: #718096;">Start a new game from scratch. This will delete all progress.</p>
                        <button class="button button-danger" id="resetBtn">Reset Game</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-title" id="modalTitle"></div>
            <div id="modalBody"></div>
            <div class="modal-buttons">
                <button class="button" id="closeModalBtn">Close</button>
            </div>
        </div>
    </div>
    <div id="propertyModal" class="modal">
        <div class="modal-content">
            <div class="modal-title" id="propertyModalTitle">Select a Property</div>
            <div id="propertyModalBody"></div>
            <div class="modal-buttons">
                <button class="button" id="confirmPropertyBtn">Confirm</button>
                <button class="button" id="cancelPropertyBtn">Cancel</button>
            </div>
        </div>
    </div>
    <script>
        const g = { cash: 0, week: 1, timeLeft: 40, dealsClosedTotal: 0, team: [], deals: [], upgrades: {} };
        let sel = null, pend = null;

        const mkOpts = [
            { id: 'gov', name: 'Pull Government List', cost: 0, leads: [3, 8], desc: 'Free public records', time: 3 },
            { id: 'ppl', name: 'Pay Per Lead', cost: 250, leads: 1, desc: '$250/lead', req: 250 },
            { id: 'ppc', name: 'Pay Per Click', cost: 2500, leads: [15, 30], desc: 'Weekly PPC ($2500)', req: 2500, time: 2 }
        ];

        const contact = [
            { id: 'call', name: 'Cold Call Leads', time: 2, cost: 0, desc: 'Call 10 leads', cnt: 10, rate: [0.2, 0.5] },
            { id: 'text', name: 'Text Blasting', time: 0.5, cost: 10, desc: '1000 texts ($10)', cnt: 1000, rate: [0.003, 0.012], req: 10 },
            { id: 'drip', name: 'Text Blast Drip', time: 1, cost: 100, desc: 'Drip campaign ($100)', cnt: 1000, rate: [0.04, 0.07], req: 100, reqUpg: 'drip' }
        ];

        const upg = {
            drip: { name: 'Drip SMS', cost: 500, ben: 'Unlock drip campaign + 2x basic text rate', type: 'text' },
            enzo: { name: 'Enzo Dialer', cost: 225, ben: '+30h/week', type: 'call', monthly: true },
            maxd: { name: 'MaxDispo.com', cost: 0, ben: '+50% deal value', type: 'dispo', reqD: 5 }
        };

        const teams = {
            va: { name: 'Virtual Assistant', role: 'VA', cost: 800, time: 20, desc: 'Cold calling & data', eff: 50, mor: 100, leads: 15, reqC: 2400, reqD: 3 },
            acq: { name: 'Acquisitions Manager', role: 'Acq', cost: 2500, time: 15, desc: 'Sources deals', eff: 50, mor: 100, deals: 3, reqC: 7500, reqD: 5 },
            dis: { name: 'Dispositions', role: 'Dis', cost: 2000, time: 10, desc: 'Buyer list', eff: 50, mor: 100, bonus: 1500, reqC: 6000, reqD: 7 }
        };

        const acts = [
            { id: 'analyze', name: 'Analyze Property', time: 1.5, cost: 0, desc: 'Run comps', prop: true, stage: 'qualified' },
            { id: 'show', name: 'Property Showing', time: 2, cost: 0, desc: 'Meet seller', prop: true, stage: 'analyzed' },
            { id: 'follow', name: 'Follow Up', time: 1, cost: 0, desc: 'Build rapport', prop: true, stage: 'followup' },
            { id: 'negotiate', name: 'Negotiate', time: 3, cost: 0, desc: 'Work terms', prop: true, stage: 'negotiation' },
            { id: 'revise', name: 'Revise Offer', time: 1, cost: 0, desc: 'New offer', prop: true, stage: 'revision' },
            { id: 'buyers', name: 'Contact Buyers', time: 4, cost: 0, desc: 'Reach buyers', prop: true, stage: 'contract' },
            { id: 'maxdispo', name: 'Dispo with MaxDispo.com', time: 0.5, cost: 0, desc: 'Quick close (50% fee)', prop: true, stage: 'contract', minVal: 10000 },
            { id: 'admin', name: 'Admin Tasks', time: 2, cost: 0, desc: 'Paperwork', prop: false }
        ];

        function init() {
            load();
            document.querySelectorAll('.nav-button').forEach(b => b.addEventListener('click', function() { showSec(this.dataset.section); }));
            document.getElementById('advanceWeekBtn').addEventListener('click', advWeek);
            document.getElementById('resetBtn').addEventListener('click', reset);
            document.getElementById('closeModalBtn').addEventListener('click', closeMod);
            document.getElementById('confirmPropertyBtn').addEventListener('click', confirmProp);
            document.getElementById('cancelPropertyBtn').addEventListener('click', closePropMod);
            renderActs();
            renderTeam();
            renderHire();
            renderUpg();
            renderDeals();
            updateUI();
        }

        function showSec(s) {
            document.querySelectorAll('.content-section').forEach(e => e.style.display = 'none');
            document.querySelectorAll('.nav-button').forEach(b => b.classList.remove('active'));
            document.getElementById('content-' + s).style.display = 'block';
            document.querySelector('[data-section="' + s + '"]').classList.add('active');
        }

        function renderActs() {
            const grid = document.getElementById('actionGrid');
            let h = '';

            mkOpts.forEach(o => {
                const hasTime = !o.time || g.timeLeft >= o.time;
                const ok = g.cash >= o.cost && hasTime;
                const lock = o.req && g.dealsClosedTotal === 0 && g.cash < o.req;
                const leadsTxt = Array.isArray(o.leads) ? `${o.leads[0]}-${o.leads[1]}` : o.leads;
                h += `<div class="action-card ${!ok || lock ? 'disabled' : ''}" onclick="${ok && !lock ? `doMkt('${o.id}')` : ''}">
                    <div class="action-title">${o.name}</div><div class="action-cost">${o.desc}</div>
                    <div style="margin-top:10px;">${o.time ? '<span class="time-badge">‚è±Ô∏è ' + o.time + 'h</span>' : ''}<span class="cost-badge">üí∞ ${o.cost === 0 ? 'FREE' : '$' + o.cost}</span>
                    <span class="time-badge">üì• ${leadsTxt}</span>${lock ? '<div class="locked-badge">Need $' + o.req + '</div>' : ''}</div></div>`;
            });

            contact.forEach(o => {
                const hasUpg = !o.reqUpg || g.upgrades[o.reqUpg];
                const ok = g.cash >= o.cost && g.timeLeft >= o.time && hasUpg;
                const lock = (o.req && g.cash < o.req) || (o.reqUpg && !g.upgrades[o.reqUpg]);
                const lockMsg = o.reqUpg && !g.upgrades[o.reqUpg] ? `Need ${upg[o.reqUpg].name}` : (o.req && g.cash < o.req ? '$' + o.cost : '');
                h += `<div class="action-card ${!ok || lock ? 'disabled' : ''}" onclick="${ok && !lock ? `doContact('${o.id}')` : ''}">
                    <div class="action-title">${o.name}</div><div class="action-cost">${o.desc}</div>
                    <div style="margin-top:10px;"><span class="time-badge">‚è±Ô∏è ${o.time}h</span>
                    <span class="cost-badge">üí∞ ${o.cost === 0 ? 'FREE' : '$' + o.cost}</span>${lock && lockMsg ? '<div class="locked-badge">' + lockMsg + '</div>' : ''}</div></div>`;
            });

            acts.forEach(a => {
                const ok = g.cash >= a.cost && g.timeLeft >= a.time;
                h += `<div class="action-card ${!ok ? 'disabled' : ''}" onclick="${ok ? `doAct('${a.id}')` : ''}">
                    <div class="action-title">${a.name}</div><div class="action-cost">${a.desc}</div>
                    <div style="margin-top:10px;"><span class="time-badge">‚è±Ô∏è ${a.time}h</span>${a.cost > 0 ? '<span class="cost-badge">üí∞ $' + a.cost + '</span>' : ''}</div></div>`;
            });

            grid.innerHTML = h;
        }

        function doMkt(id) {
            const o = mkOpts.find(x => x.id === id);
            if (g.cash < o.cost || (o.time && g.timeLeft < o.time)) return;
            g.cash -= o.cost;
            if (o.time) g.timeLeft -= o.time;

            // 25% chance of getting 0 leads (except for PPL)
            if (id !== 'ppl' && Math.random() < 0.25) {
                notify(`${o.name}: No leads.`);
                updateUI();
                renderActs();
                renderDeals();
                save();
                return;
            }

            const leadCnt = Array.isArray(o.leads) ? Math.floor(Math.random() * (o.leads[1] - o.leads[0] + 1)) + o.leads[0] : o.leads;
            genLeads(leadCnt);
            notify(`${o.name}: ${leadCnt} leads!`, 'advance');
            updateUI();
            renderActs();
            renderDeals();
            save();
        }

        function doContact(id) {
            const o = contact.find(x => x.id === id);
            if (g.timeLeft < o.time || g.cash < o.cost) return;

            const leadPool = g.deals.filter(d => d.stage === 'lead');
            const toContact = Math.min(o.cnt, leadPool.length);

            if (toContact === 0) {
                notify(`${o.name}: No leads to contact!`);
                return;
            }

            g.timeLeft -= o.time;
            g.cash -= o.cost;

            // Take leads from pool
            const contacted = leadPool.slice(0, toContact);
            g.deals = g.deals.filter(d => !contacted.includes(d));

            // 25% chance of getting 0 qualified
            if (Math.random() < 0.25) {
                notify(`${o.name}: Contacted ${toContact}, none qualified.`);
                updateUI();
                renderActs();
                renderDeals();
                save();
                return;
            }

            let r = Array.isArray(o.rate) ? Math.random() * (o.rate[1] - o.rate[0]) + o.rate[0] : o.rate;
            if (id === 'text' && g.upgrades.drip) r *= 2;
            let q = Math.floor(toContact * r);

            if (q > 0) {
                // Convert contacted leads to qualified
                contacted.slice(0, q).forEach(d => {
                    d.stage = 'qualified';
                    g.deals.push(d);
                });
                notify(`${o.name}: ${q} of ${toContact} qualified!`, 'advance');
            } else {
                notify(`${o.name}: Contacted ${toContact}, none qualified.`);
            }

            updateUI();
            renderActs();
            renderDeals();
            save();
        }

        function doAct(id) {
            const a = acts.find(x => x.id === id);
            if (!a || g.timeLeft < a.time || g.cash < a.cost) {
                notify('Not enough time/cash!');
                return;
            }
            if (a.prop) {
                showPropModal(a);
            } else {
                execAct(a, null);
            }
        }

        function showPropModal(a) {
            let deals = g.deals.filter(d => d.stage === a.stage);
            if (a.minVal) deals = deals.filter(d => d.value >= a.minVal);
            if (deals.length === 0) {
                notify(a.minVal ? `No properties over $${a.minVal.toLocaleString()}.` : `No ${a.stage} properties.`);
                return;
            }
            pend = a;
            const m = document.getElementById('propertyModal');
            const b = document.getElementById('propertyModalBody');
            document.getElementById('propertyModalTitle').textContent = `Select - ${a.name}`;
            b.innerHTML = `<div style="margin-bottom:15px;color:#718096;">Select property:</div><div class="property-list">
                ${deals.map(d => `<div class="property-option" data-id="${d.id}">
                <div style="font-weight:bold;margin-bottom:4px;">${d.address}</div>
                <div style="font-size:13px;color:#718096;">Fee: <span style="color:#48bb78;font-weight:bold;">$${d.value}</span></div></div>`).join('')}</div>`;
            document.querySelectorAll('.property-option').forEach(o => {
                o.addEventListener('click', function() {
                    document.querySelectorAll('.property-option').forEach(x => x.classList.remove('selected'));
                    this.classList.add('selected');
                    sel = deals.find(d => d.id === parseInt(this.dataset.id));
                });
            });
            m.classList.add('active');
        }

        function confirmProp() {
            if (!sel || !pend) return;
            execAct(pend, sel);
            closePropMod();
        }

        function closePropMod() {
            document.getElementById('propertyModal').classList.remove('active');
            sel = null;
            pend = null;
        }

        function execAct(a, p) {
            g.timeLeft -= a.time;
            g.cash -= a.cost;

            switch(a.id) {
                case 'analyze':
                    if (p && Math.random() > 0.3) {
                        p.stage = 'analyzed';
                        notify(`${p.address} analyzed!`, 'advance');
                    } else {
                        g.deals = g.deals.filter(d => d.id !== p.id);
                        notify('Numbers don\'t work.');
                    }
                    break;
                case 'show':
                    if (p && Math.random() > 0.5) {
                        p.stage = 'negotiation';
                        notify(`${p.address} interested!`, 'advance');
                    } else {
                        p.stage = 'followup';
                        notify(`${p.address} needs time.`);
                    }
                    break;
                case 'follow':
                    if (p && Math.random() > 0.6) {
                        p.stage = 'negotiation';
                        notify(`${p.address} ready!`, 'advance');
                    } else {
                        if (Math.random() > 0.5) p.stage = 'revision';
                        notify(`${p.address} ${p.stage === 'revision' ? 'wants revision' : 'still thinking'}.`);
                    }
                    break;
                case 'revise':
                    if (p && Math.random() > 0.65) {
                        p.stage = 'analyzed';
                        notify(`${p.address} accepted!`, 'advance');
                    } else {
                        if (Math.random() > 0.5) {
                            g.deals = g.deals.filter(d => d.id !== p.id);
                            notify(`${p.address} fell through.`);
                        } else {
                            notify(`${p.address} try again.`);
                        }
                    }
                    break;
                case 'negotiate':
                    if (p && Math.random() > 0.4) {
                        p.stage = 'contract';
                        notify(`${p.address} signed!`, 'advance');
                    } else {
                        p.stage = 'revision';
                        notify(`${p.address} revise.`);
                    }
                    break;
                case 'buyers':
                    if (p && Math.random() > 0.3) {
                        closeDeal(p);
                    } else {
                        notify('Contacted buyers.');
                    }
                    break;
                case 'maxdispo':
                    if (p) {
                        const halfVal = Math.floor(p.value * 0.5);
                        const dis = g.team.find(m => m.role === 'Dis');
                        let tot = halfVal;
                        if (dis) tot += dis.bonus;
                        g.cash += tot;
                        g.dealsClosedTotal++;
                        g.deals = g.deals.filter(x => x.id !== p.id);
                        notify(`${p.address} closed via Max! $${tot} (50% fee) üéâ`, 'advance');
                        renderHire();
                        renderUpg();
                    }
                    break;
                case 'admin':
                    notify('Admin done.');
                    break;
            }

            updateUI();
            renderDeals();
            renderActs();
            save();
        }

        function genLeads(cnt, stage) {
            stage = stage || 'lead';
            for (let i = 0; i < cnt; i++) {
                g.deals.push({
                    id: Date.now() + i,
                    address: Math.floor(Math.random() * 9999) + 100 + ' Main St',
                    value: Math.floor(Math.random() * 8000) + 3000,
                    stage: stage,
                    week: g.week
                });
            }
        }

        function closeDeal(d) {
            let tot = d.value;
            if (g.upgrades.maxd) tot += Math.floor(d.value * 0.5);
            const dis = g.team.find(m => m.role === 'Dis');
            if (dis) tot += dis.bonus;
            g.cash += tot;
            g.dealsClosedTotal++;
            g.deals = g.deals.filter(x => x.id !== d.id);
            notify(`${d.address} closed! $${tot} üéâ`, 'advance');
            updateUI();
            renderDeals();
            renderHire();
            renderUpg();
            save();
        }

        function renderDeals() {
            const p = document.getElementById('dealPipeline');
            const stages = { lead: 'New Leads', qualified: 'Qualified', analyzed: 'Analyzed', followup: 'Follow Up', revision: 'Revision', negotiation: 'Negotiation', contract: 'Contract' };
            p.innerHTML = Object.entries(stages).map(([s, t]) => {
                const ds = g.deals.filter(d => d.stage === s);
                return `<div class="pipeline-column"><div class="pipeline-title">${t} (${ds.length})</div>
                    ${ds.map(d => `<div class="deal-card"><div>${d.address}</div><div class="deal-value">$${d.value}</div></div>`).join('')}</div>`;
            }).join('');
        }

        function renderTeam() {
            const grid = document.getElementById('teamGrid');
            const msg = document.getElementById('soloMessage');
            if (g.team.length === 0) {
                grid.style.display = 'none';
                msg.style.display = 'block';
                return;
            }
            grid.style.display = 'grid';
            msg.style.display = 'none';
            grid.innerHTML = g.team.map(m => `<div class="team-member">
                <div class="team-member-header"><div><div class="team-member-name">${m.name}</div>
                <div class="team-member-role">${m.role}</div></div>
                <button class="button button-small button-danger" onclick="fire('${m.id}')">Fire</button></div>
                <div class="info-row"><span class="info-label">Monthly:</span><span class="info-value">$${m.cost}</span></div>
                <div style="margin-top:10px;"><div style="font-size:12px;color:#718096;margin-bottom:5px;">Eff: ${m.eff}%</div>
                <div class="progress-bar"><div class="progress-fill" style="width:${m.eff}%"></div></div></div></div>`).join('');
        }

        function renderHire() {
            const grid = document.getElementById('hireGrid');
            grid.innerHTML = Object.entries(teams).map(([k, t]) => {
                const cost = t.reqC || (t.cost * 3);
                const ok = g.cash >= cost && (!t.reqD || g.dealsClosedTotal >= t.reqD);
                return `<div class="hire-card"><div class="card-title">${t.name}</div>
                    <div style="color:#718096;margin-bottom:15px;font-size:14px;">${t.desc}</div>
                    <div class="info-row"><span class="info-label">Monthly:</span><span class="info-value">$${t.cost}</span></div>
                    <div class="info-row"><span class="info-label">Hire (3mo):</span><span class="info-value">$${cost}</span></div>
                    ${t.reqD ? `<div class="info-row"><span class="info-label">Requires:</span><span class="info-value">${t.reqD} deals</span></div>` : ''}
                    <div style="margin-top:15px;"><button class="button ${ok ? 'button-success' : ''}" onclick="hire('${k}')" ${!ok ? 'disabled' : ''}>
                    ${ok ? 'Hire' : 'Locked'}</button></div></div>`;
            }).join('');
        }

        function renderUpg() {
            const grid = document.getElementById('upgradeGrid');
            grid.innerHTML = Object.entries(upg).map(([k, u]) => {
                const own = g.upgrades[k] || false;
                const ok = g.cash >= u.cost && (!u.reqD || g.dealsClosedTotal >= u.reqD) && !own;
                return `<div class="hire-card"><div class="card-title">${u.name} ${own ? '‚úì' : ''}</div>
                    <div style="color:#718096;margin-bottom:15px;font-size:14px;">${u.ben}</div>
                    <div class="info-row"><span class="info-label">Cost:</span><span class="info-value">${u.cost === 0 ? 'FREE' : '$' + u.cost}${u.monthly ? '/mo' : ''}</span></div>
                    ${u.reqD ? `<div class="info-row"><span class="info-label">Requires:</span><span class="info-value">${u.reqD} deals</span></div>` : ''}
                    <div style="margin-top:15px;"><button class="button ${ok ? 'button-success' : ''}" onclick="buyUpg('${k}')" ${!ok ? 'disabled' : ''}>
                    ${own ? 'Owned' : (ok ? 'Buy' : 'Locked')}</button></div></div>`;
            }).join('');
        }

        function buyUpg(k) {
            const u = upg[k];
            if (g.upgrades[k] || g.cash < u.cost) return;
            g.cash -= u.cost;
            g.upgrades[k] = true;
            if (k === 'enzo') g.timeLeft += 30;
            notify(`${u.name} bought!`, 'advance');
            updateUI();
            renderUpg();
            renderActs();
            save();
        }

        function hire(k) {
            const t = teams[k];
            const cost = t.reqC || (t.cost * 3);
            if (g.cash < cost) { notify('Not enough cash!'); return; }
            g.cash -= cost;
            g.team.push({ id: Date.now().toString(), name: t.name, role: t.role, cost: t.cost, time: t.time, desc: t.desc, eff: t.eff, mor: t.mor, leads: t.leads, deals: t.deals, bonus: t.bonus, week: g.week });
            notify(`${t.name} hired!`, 'advance');
            updateUI();
            renderTeam();
            renderHire();
            save();
        }

        function fire(id) {
            if (!confirm('Fire this team member?')) return;
            g.team = g.team.filter(m => m.id !== id);
            notify('Fired.');
            updateUI();
            renderTeam();
            save();
        }

        function advWeek() {
            if (g.week % 4 === 0) {
                let costs = g.team.reduce((sum, m) => sum + m.cost, 0);
                if (g.upgrades.enzo) costs += 225;
                if (g.cash < costs) {
                    showMod('üí∏ Cash Crisis!', `<p style="color:#f56565;margin-bottom:15px;">Can't pay expenses!</p>
                        <div class="info-row"><span class="info-label">Expenses:</span><span class="info-value">$${costs}</span></div>
                        <div class="info-row"><span class="info-label">Cash:</span><span class="info-value">$${g.cash}</span></div>`);
                    return;
                }
                g.cash -= costs;
                notify('Monthly paid: $' + costs);
            }

            g.team.forEach(m => { if (m.eff < 100) m.eff = Math.min(100, m.eff + 10); });
            g.team.forEach(m => {
                if (m.role === 'VA' && m.leads) {
                    const l = Math.floor(m.leads * (m.eff / 100));
                    if (l > 0) {
                        genLeads(l);
                        notify(`${m.name}: ${l} leads!`, 'advance');
                    }
                }
            });

            g.week++;
            g.timeLeft = 40;
            g.team.forEach(m => { g.timeLeft += Math.floor(m.time * (m.eff / 100)); });
            if (g.upgrades.enzo) g.timeLeft += 30;

            updateUI();
            renderDeals();
            renderActs();
            save();
            notify(`Week ${g.week}: ${g.timeLeft}h available.`, 'advance');
        }

        function updateUI() {
            document.getElementById('cash').textContent = g.cash.toLocaleString();
            document.getElementById('week').textContent = g.week;
            document.getElementById('dealsCount').textContent = g.dealsClosedTotal;
            document.getElementById('timeLeft').textContent = g.timeLeft;
        }

        function notify(msg, type) {
            type = type || 'neutral';
            const n = document.createElement('div');
            n.className = 'notification';
            if (type === 'advance') {
                n.style.borderLeftColor = '#48bb78';
                n.style.background = '#f0fdf4';
            } else {
                n.style.borderLeftColor = '#f56565';
                n.style.background = '#fef2f2';
            }
            n.textContent = msg;
            document.body.appendChild(n);
            setTimeout(() => n.remove(), 3000);
        }

        function showMod(title, body) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalBody').innerHTML = body;
            document.getElementById('modal').classList.add('active');
        }

        function closeMod() {
            document.getElementById('modal').classList.remove('active');
        }

        function save() {
            localStorage.setItem('teamBuildingTycoon', JSON.stringify(g));
        }

        function load() {
            const s = localStorage.getItem('teamBuildingTycoon');
            if (s) Object.assign(g, JSON.parse(s));
        }

        function reset() {
            if (!confirm('Reset?')) return;
            localStorage.removeItem('teamBuildingTycoon');
            location.reload();
        }

        init();
    </script>
</body>
</html>
